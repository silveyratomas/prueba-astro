---
import Layout from "../layouts/Layout.astro";
import { API_BASE, DEFAULT_STORE_SLUG } from "../config";

// Seleccionamos la tienda desde la query ?store=... o usamos la default
const storeSlug = Astro.url.searchParams.get("store") || DEFAULT_STORE_SLUG;
---

<Layout title="Listado (box)">
  <nav class="text-sm text-[var(--muted)] mb-4" aria-label="Breadcrumb">
    <ol class="flex items-center gap-2">
      <li><a href="/" class="hover:underline">Inicio</a></li>
      <li aria-hidden="true">/</li>
      <li>
        <a
          href={`/listado_box?store=${encodeURIComponent(storeSlug)}`}
          class="text-[var(--text)] font-medium line-clamp-1">Productos</a
        >
      </li>
    </ol>
  </nav>

  <div
    class="bg-[var(--card)] border border-[var(--card-border)] rounded-xl p-4"
  >
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-start">
      <aside class="lg:col-span-1 pr-2">
        <h3 class="font-semibold mb-2 text-sm">Categorías</h3>
        <div class="text-[var(--muted)] mb-2 text-xs">
          Seleccioná una categoría para ver sus productos.
        </div>
        <div class="overflow-auto max-h-[60vh] text-sm" id="catTree">
          <p class="text-[var(--muted)]">Cargando categorías…</p>
        </div>
        <div class="mt-3">
          <button id="catAllBtn" class="btn-outline w-full text-sm"
            >Ver todos los productos</button
          >
        </div>
      </aside>

      <section class="lg:col-span-3">
        <div class="mb-3 flex items-center justify-between">
          <h4 id="catTitle" class="text-lg font-semibold">
            Todos los productos
          </h4>
          <span id="catCount" class="text-sm text-[var(--muted)]">&nbsp;</span>
        </div>

        <div
          id="cards"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
        >
          <!-- Productos renderizados por src/scripts/listado.ts -->
        </div>

        <p id="noResults" class="hidden mt-6 text-center text-[var(--muted)]">
          No encontramos productos que coincidan con tu búsqueda.
        </p>
      </section>
    </div>
  </div>

  <!-- Configuración para el script cliente -->
  <div
    id="list-config"
    data-api={API_BASE}
    data-store={storeSlug}
    style="display:none"
  >
  </div>
  <script type="module" src="/src/scripts/listado.ts"></script>
</Layout>
